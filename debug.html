<!DOCTYPE html>
<html>
<head>
    <title>Debug Chess Moves</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
</head>
<body>
    <h2>Move Sequence Debug</h2>
    <div id="output"></div>
    <script>
        const game = new Chess();
        const output = document.getElementById('output');

        // Play the sequence up to and past Qd2
        const sequence = [
            'e4', 'g6',
            'd4', 'Bg7',
            'Nc3', 'd6',
            'f4', 'Nf6',
            'Nf3', 'O-O',
            'Be3', 'c6',
            'Qd2', 'Nc6',
            'O-O-O'
        ];

        let html = '<h3>Playing moves:</h3>';
        sequence.forEach((move, i) => {
            const result = game.move(move);
            const color = i % 2 === 0 ? 'White' : 'Black';
            html += `<p>${color} move ${Math.floor(i/2)+1}: ${move} => ${result ? '✓ ' + result.san : '✗ FAILED'}</p>`;
        });

        html += `<p><strong>Position after moves:</strong> ${game.fen()}</p>`;
        html += '<h3>Legal moves for Black:</h3><ul>';
        game.moves().slice(0, 20).forEach(m => {
            html += `<li>${m}</li>`;
        });
        html += '</ul>';

        // Check if O-O-O is a legal move before Nc6
        game.undo(); // undo O-O-O
        html += '<h3>After Nc6, legal moves for White include:</h3><ul>';
        const whiteMoves = game.moves({ verbose: true });
        whiteMoves.slice(0, 30).forEach(m => {
            html += `<li>${m.san} (from: ${m.from}, to: ${m.to})</li>`;
        });
        html += '</ul>';

        // Check if O-O-O exists
        const castleMove = whiteMoves.find(m => m.san === 'O-O-O');
        if (castleMove) {
            html += '<p style="color: green; font-weight: bold;">✓ O-O-O is available!</p>';
        } else {
            html += '<p style="color: red; font-weight: bold;">✗ O-O-O is NOT available!</p>';
        }

        output.innerHTML = html;
    </script>
</body>
</html>
